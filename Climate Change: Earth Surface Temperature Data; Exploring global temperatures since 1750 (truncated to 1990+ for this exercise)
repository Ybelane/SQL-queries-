1---How many countries are represented in this dataset?---
select Count(distinct country) as Countries
from temperatures_by_country;


2--- How many temperatures with a null value exist in this dataset? What is the overall percentage of null temperatures?

select 
count(case when avg_temp is null then 1 end) as null_count,
count(case when avg_temp is null then 1 end)::NUMERIC/ count(*)*100 as pct_null
from temperatures_by_country;


3--What is the earliest and latest year represented in this dataset?
select min(dt) as earliest, max(dt) as latest
from temperatures_by_country;

4---What are the top 10 countries with the highest average temperature?
SELECT country, round(AVG(avg_temp)::numeric, 2) AS AverageTemperature
FROM temperatures_by_country
where avg_temp is not null
GROUP BY country
ORDER BY AverageTemperature DESC
LIMIT 10;

5---Between the years 2000 and 2013, what difference in average yearly temperature between Djibouti and Greenland
select
	year,
  max(case when country = 'Djibouti' then avg_temp end) -
  	max(case when country = 'Greenland' then avg_temp end) temperature_difference
from (
	select date_part('year', dt) as year,
    country,
    avg(avg_temp) as avg_temp
  from temperatures_by_country
  where country in (
    'Djibouti',
    'Greenland'
    )
    and date_part('year', dt) between 2000 and 2013
  group by 1, 2
) r
group by 1
order by 1 desc

6--- Starting from the year 2000, what is the relative change in overall climate year-over-year in Fahrenheit.relative change = ((x2 - x1) / x1)
with raw_data as (
  select year, avg_temp_f,
    lag(avg_temp_f) over (
      order by year
    ) as prev_avg_temp_f
  from (
    select date_part('year', dt) as year,
      avg(avg_temp)::numeric * (9/5) + 32 avg_temp_f
    from temperatures_by_country
    group by 1
  ) r
)
select year, avg_temp_f, prev_avg_temp_f,
	((avg_temp_f - prev_avg_temp_f) /
  	avg_temp_f) as relative_change
from raw_data
where year >= 2000
order by 1;
